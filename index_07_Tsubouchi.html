<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>AIæ´»ç”¨ã‚¢ãƒ—ãƒª 07_Tsubouchi</title>
    <!-- jQueryèª­ã¿è¾¼ã¿ -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- axiosèª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- CSSèª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>
    <header>
        <h1>AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ 07_Tsubouchi</h1>
    </header>
    <main>
        <div id="chat-area">
        <div class="message ai">
            ğŸ¤– AIã‹ã‚‰ã®å›ç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
        </div>           
        </div>
        <textarea id="user-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."></textarea>
        <ul>
            <li id="send">é€ä¿¡</li>
        </ul>
    </main>


<!-- <script type="module" src="js/script.js"> -->
<script type="module">
    // <!-- // -=-=-=-=-=-=-=-==-=-=-=-=-=-=-=-=-=-=-== -->
    // <!-- // â˜… ã®ç®‡æ‰€ã‚’é †ã«å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼ -->
    // <!-- // -=-=-=-=-=-=-=-==-=-=-=-=-=-=-=-=-=-=-== -->

    // <!-- // â˜… js/config.js ã« APIã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ -->

    // <!-- // APIã‚­ãƒ¼ã®æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€ -->
import { GEMINI_API_KEY } from "./js/config.js";

let chatHistory = [];

// <!-- // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ -->
$("#send").on("click", function () {
    const userMessage = $("#user-input").val(); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
    if (!userMessage) return; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç©ºã®å ´åˆã¯å‡¦ç†ã‚’çµ‚äº†

    $("#chat-area").append(`<div class='message user'>ğŸ‘¤ ${userMessage}</div>`); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    $("#user-input").val(""); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

    // â˜… Gemini API ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•° callGeminiAPI ã‚’å‘¼ã³å‡ºã™
    callGeminiAPI(userMessage)


});

// ãƒãƒ£ãƒƒãƒˆã‚¯ãƒªã‚¢
$("#clear").on("click", function () {
    $("#chat-area").html(`<div class='message ai'>ğŸ¤– ã“ã‚“ã«ã¡ã¯ï¼ä½•ã§ã‚‚ãŠèããã ã•ã„ï¼</div>`); // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚»ãƒƒãƒˆ
    chatHistory = []; // ä¼šè©±å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
});

// Gemini APIå‘¼ã³å‡ºã—é–¢æ•°
function callGeminiAPI(message) {
    // â˜… Google AI Studio or API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’å‚è€ƒã« URL ã‚’è¨­å®šã™ã‚‹
    // API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹: https://ai.google.dev/api?hl=ja
    // URL è¨­å®šä¾‹: https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent

    const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent";

    // Gemini APIã«æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ ã‚’ä½œæˆ
    const data = {
        contents: [
            {
                parts: [{ text: message }],
            },
        ],
    }

    // Gemini APIã‚’å‘¼ã³å‡ºã—
    axios.post(url, data, { headers: { "x-goog-api-key": GEMINI_API_KEY}}) // URL, ãƒ‡ãƒ¼ã‚¿, ãƒ˜ãƒƒãƒ€æƒ…å ±ï¼ˆèªè¨¼æƒ…å ±ï¼‰
        .then(function (response) {
    // ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
            const data = response.data;

    // â˜… AIã®å›ç­”ã‚’å–å¾— ... data.candidates[0].content.parts[0].text
            const aiResponse = data.candidates[0].content.parts[0].text;
   
            $("#chat-area").append(`<div class='message ai'>ğŸ¤– ${aiResponse}</div>`); // AIã®å›ç­”ã‚’è¡¨ç¤º
        })
        .catch(function (error) {
            console.error("API Error:", error); // APIã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
            $("#chat-area").append(`<div class="message ai">ğŸ¤– ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚API ã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>`);
        });
}

</script>
</body>
</html>